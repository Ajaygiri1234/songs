<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <style>
        /* Basic styles for the player */
        #music-player {
            margin: 20px;
        }
        .song-list {
            list-style-type: none;
            padding: 0;
        }
        .song-list li {
            margin-bottom: 5px;
            cursor: pointer;
        }
        .song-list li.playing {
            background-color: #48e67c;
        }
        .form-container {
            margin-bottom: 20px;
        }
        .form-container label {
            display: block;
            margin-bottom: 5px;
        }
        .form-container input {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <label for="ownerInput">Owner:</label>
        <input type="text" id="ownerInput" placeholder="Enter owner" value="ajaygiri1234">

        <label for="repoInput">Repo:</label>
        <input type="text" id="repoInput" placeholder="Enter repo" value="songs">

        <button onclick="fetchAndDisplaySongs()">Fetch Songs</button>
    </div>

    <div id="music-player">
        <h2>Music Player</h2>
       
        <ul id="songList" class="song-list"></ul>
        <audio id="audio-player" controls onended="playNextSong()">
            Your browser does not support the audio element.
        </audio>
    </div>

    <script>
        var currentSongIndex = null;
        var songElements = [];

        function playSong(song, index) {
            var audioPlayer = document.getElementById('audio-player');
            audioPlayer.src = song; // Adjust the song filename pattern as needed
            audioPlayer.play();

            // Remove the 'playing' class from the previously selected song
            if (currentSongIndex !== null) {
                songElements[currentSongIndex].classList.remove('playing');
            }

            // Add the 'playing' class to the currently selected song
            songElements[index].classList.add('playing');
            currentSongIndex = index;
        }

        function playNextSong() {
            var nextIndex = (currentSongIndex + 1) % songElements.length;
            playSong(songElements[nextIndex].textContent, nextIndex);
        }

        async function fetchAndStoreFiles(owner, repo, path) {
            try {
                const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch file list.');
                }
                
                const data = await response.json();
                
                const mp3mp4Files = data
                    .filter(item => {
                        const fileName = item.name.toLowerCase();
                        return fileName.endsWith('.mp3') || fileName.endsWith('.mp4');
                    })
                    .map(item => item.path);
                    
                return mp3mp4Files;
            } catch (error) {
                console.error('Error:', error);
                return null; // or handle the error as needed
            }
        }

        async function fetchAndDisplaySongs() {
            const ownerInput = document.getElementById('ownerInput').value.trim() || 'ajaygiri1234';
            const repoInput = document.getElementById('repoInput').value.trim() || 'songs';

            const listOfSongs = await fetchAndStoreFiles(ownerInput, repoInput, '');

            if (listOfSongs) {
                console.log('MP3 and MP4 Files:', listOfSongs);
                const songList = document.getElementById('songList');
                songList.innerHTML = ''; // Clear previous songs

                // Loop through the listOfSongs and create LI elements dynamically
                listOfSongs.forEach((song, index) => {
                    const li = document.createElement('li');
                    li.textContent = song;
                    li.setAttribute('onclick', `playSong('${song}',${index})`);
                    songList.appendChild(li);
                    songElements.push(li);
                });
            } else {
                console.error('Failed to fetch songs.');
            }
        }
    </script>
</body>
</html>
